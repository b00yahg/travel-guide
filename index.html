<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D&D Travel Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #2a3f2b;
            --primary-medium: #3c5a3e;
            --primary-light: #5c8a5f;
            --bg-main: #e6d8b5;
            --bg-container: #f0e6c8;
            --bg-content: #f9f3e3;
            --accent-danger: #8a5c5c;
            --accent-highlight: #ffd700;
            --disabled-text: #8a5c5c;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-main);
            color: var(--primary-dark);
            padding: 20px;
            margin: 0;
        }

        .travel-planner {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--bg-content);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-medium);
            padding-bottom: 15px;
        }

        .header h1 {
            font-family: 'Uncial Antiqua', cursive;
            color: var(--primary-dark);
            margin: 0;
            font-size: 2.5em;
        }

        .journey-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .journey-info input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--primary-medium);
            border-radius: 4px;
            background-color: var(--bg-container);
        }

        .stage {
            background-color: var(--bg-container);
            border: 2px solid var(--primary-medium);
            border-radius: 8px;
            margin-bottom: 20px;
            padding: 15px;
        }

        .stage-header {
            background-color: rgba(92, 138, 95, 0.2);
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stage-header h2 {
            margin: 0;
            font-family: 'Uncial Antiqua', cursive;
            color: var(--primary-dark);
        }

        .stage-content {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 20px;
        }

        .stage-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stage-info label {
            font-weight: bold;
        }

        .stage-info input,
        .stage-info select {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--primary-medium);
            border-radius: 4px;
            background-color: var(--bg-content);
        }

        .pace-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .pace-option {
            text-align: center;
            padding: 10px;
            background-color: var(--bg-content);
            border: 1px solid var(--primary-medium);
            border-radius: 4px;
        }

        .pace-option.disabled {
            color: var(--disabled-text);
            background-color: rgba(138, 92, 92, 0.1);
        }

        .notes-section,
        .challenges-section {
            margin-top: 15px;
            padding: 10px;
            background-color: var(--bg-content);
            border-radius: 4px;
        }

        .notes-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 8px;
            border: 1px solid var(--primary-medium);
            border-radius: 4px;
            background-color: var(--bg-content);
            resize: vertical;
        }

        .elapsed-time {
            text-align: right;
            margin-top: 10px;
        }

        .add-stage-btn {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background-color: var(--primary-light);
            color: var(--bg-content);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Uncial Antiqua', cursive;
            transition: background-color 0.3s;
        }

        .add-stage-btn:hover {
            background-color: var(--primary-medium);
        }

        .delete-stage-btn {
            background-color: var(--accent-danger);
            color: var(--bg-content);
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .reference-section {
            margin-top: 30px;
            padding: 15px;
            background-color: var(--bg-container);
            border-radius: 8px;
        }

        .reference-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--primary-light);
            color: var(--bg-content);
            border-radius: 4px;
        }

        .reference-content {
            padding: 15px;
            display: none;
        }

        .reference-content.show {
            display: block;
        }

        .dc-display {
            margin-top: 10px;
            padding: 10px;
            background-color: var(--bg-content);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="travel-planner">
        <div class="header">
            <h1>Travel Planner</h1>
        </div>

        <div class="journey-info">
            <div>
                <label for="origin">Origin:</label>
                <input type="text" id="origin">
            </div>
            <div>
                <label for="destination">Destination:</label>
                <input type="text" id="destination">
            </div>
        </div>

        <div id="stages-container">
            <!-- Stages will be dynamically added here -->
        </div>

        <button class="add-stage-btn" onclick="addStage()">Add New Stage</button>

        <div class="reference-section">
            <div class="reference-header" onclick="toggleReference()">
                <h3>Travel Rules Reference</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="reference-content" id="reference-content">
                <!-- Reference content will be added here -->
            </div>
        </div>
    </div>

    <script>
        // Stage template function will go here
        function createStageTemplate(stageNum) {
            return `
                <div class="stage" id="stage-${stageNum}">
                    <div class="stage-header">
                        <h2>Stage ${stageNum}</h2>
                        <button class="delete-stage-btn" onclick="deleteStage(${stageNum})">Delete Stage</button>
                    </div>
                    <div class="stage-content">
                        <div class="stage-info">
                            <div>
                                <label for="start-${stageNum}">Start:</label>
                                <input type="text" id="start-${stageNum}">
                            </div>
                            <div>
                                <label for="end-${stageNum}">End:</label>
                                <input type="text" id="end-${stageNum}">
                            </div>
                            <div>
                                <label for="distance-${stageNum}">Distance:</label>
                                <input type="number" id="distance-${stageNum}" onchange="updateTravelTimes(${stageNum})">
                            </div>
                            <div>
                                <label for="terrain-${stageNum}">Terrain:</label>
                                <select id="terrain-${stageNum}" onchange="updateTerrainInfo(${stageNum})">
                                    <option value="arctic">Arctic</option>
                                    <option value="coastal">Coastal</option>
                                    <option value="desert">Desert</option>
                                    <option value="forest">Forest</option>
                                    <option value="grassland">Grassland</option>
                                    <option value="hill">Hill</option>
                                    <option value="mountain">Mountain</option>
                                    <option value="swamp">Swamp</option>
                                    <option value="underdark">Underdark</option>
                                    <option value="urban">Urban</option>
                                    <option value="waterborne">Waterborne</option>
                                </select>
                            </div>
                            <div>
                                <label for="rations-${stageNum}">Available Rations:</label>
                                <input type="number" id="rations-${stageNum}" min="0">
                            </div>
                            <div>
                                <label>Weather:</label>
                                <select id="weather-${stageNum}">
                                    <option value="normal">Normal for season</option>
                                    <option value="cold">Colder (1d4 × 10°F)</option>
                                    <option value="hot">Hotter (1d4 × 10°F)</option>
                                </select>
                            </div>
                        </div>
                        <div class="pace-container">
                            <div class="pace-options">
                                <div class="pace-option" id="fast-${stageNum}">
                                    <div>Fast</div>
                                    <div class="time">-- days/hrs</div>
                                </div>
                                <div class="pace-option" id="normal-${stageNum}">
                                    <div>Normal</div>
                                    <div class="time">-- days/hrs</div>
                                </div>
                                <div class="pace-option" id="slow-${stageNum}">
                                    <div>Slow</div>
                                    <div class="time">-- days/hrs</div>
                                </div>
                            </div>
                            <div class="dc-display" id="dc-display-${stageNum}">
                                <!-- DCs will be displayed here -->
                            </div>
                        </div>
                    </div>
                    <div class="stage-bottom">
                        <div class="notes-section">
                            <label for="notes-${stageNum}">Narrative Notes:</label>
                            <textarea id="notes-${stageNum}"></textarea>
                        </div>
                        <div class="challenges-section">
                            <label>Challenges:</label>
                            <select id="challenge-type-${stageNum}" onchange="addChallenge(${stageNum})">
                                <option value="">Select a challenge...</option>
                                <option value="damage">Damage</option>
                                <option value="exhaustion">Exhaustion</option>
                                <option value="condition">Another Condition</option>
                                <option value="ambush">Ambush</option>
                                <option value="attack">Attack from Above</option>
                                <option value="distant">Distant Sighting</option>
                                <option value="found">Found by Chance</option>
                                <option value="pursuit">Pursuit</option>
                            </select>
                            <div id="challenges-list-${stageNum}" class="challenges-list"></div>
                        </div>
                        <div class="elapsed-time">
                            <label>Elapsed Time:</label>
                            <input type="text" id="elapsed-${stageNum}" readonly>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initial stage
        let stageCount = 0;
        addStage();
        // Terrain data with restrictions and DCs
        const terrainData = {
            arctic: { 
                maxPace: "fast", 
                note: "Appropriate equipment (such as skis) needed for Fast pace",
                foragingDC: 20,
                navigationDC: 10,
                searchDC: 10,
                encounterDistance: "6d6 × 10 feet"
            },
            coastal: { 
                maxPace: "normal",
                foragingDC: 10,
                navigationDC: 5,
                searchDC: 15,
                encounterDistance: "2d10 × 10 feet"
            },
            desert: { 
                maxPace: "normal",
                foragingDC: 20,
                navigationDC: 10,
                searchDC: 10,
                encounterDistance: "6d6 × 10 feet"
            },
            forest: { 
                maxPace: "normal",
                foragingDC: 10,
                navigationDC: 15,
                searchDC: 15,
                encounterDistance: "2d8 × 10 feet"
            },
            grassland: { 
                maxPace: "fast",
                foragingDC: 15,
                navigationDC: 5,
                searchDC: 15,
                encounterDistance: "6d6 × 10 feet"
            },
            hill: { 
                maxPace: "normal",
                foragingDC: 15,
                navigationDC: 10,
                searchDC: 15,
                encounterDistance: "2d10 × 10 feet"
            },
            mountain: { 
                maxPace: "slow",
                foragingDC: 20,
                navigationDC: 15,
                searchDC: 20,
                encounterDistance: "4d10 × 10 feet"
            },
            swamp: { 
                maxPace: "slow",
                foragingDC: 10,
                navigationDC: 15,
                searchDC: 20,
                encounterDistance: "2d8 × 10 feet"
            },
            underdark: { 
                maxPace: "normal",
                foragingDC: 20,
                navigationDC: 10,
                searchDC: 20,
                encounterDistance: "2d6 × 10 feet"
            },
            urban: { 
                maxPace: "normal",
                foragingDC: 20,
                navigationDC: 15,
                searchDC: 15,
                encounterDistance: "2d6 × 10 feet"
            },
            waterborne: { 
                maxPace: "special",
                note: "Travel pace depends on the vehicle",
                foragingDC: 15,
                navigationDC: 10,
                searchDC: 15,
                encounterDistance: "6d6 × 10 feet"
            }
        };

        // Travel pace calculations (miles per day)
        const paceSpeeds = {
            fast: 30,
            normal: 24,
            slow: 18
        };

        function addStage() {
            stageCount++;
            const stagesContainer = document.getElementById('stages-container');
            stagesContainer.insertAdjacentHTML('beforeend', createStageTemplate(stageCount));
            updateTerrainInfo(stageCount);
        }

        function deleteStage(stageNum) {
            const stage = document.getElementById(`stage-${stageNum}`);
            stage.remove();
        }

        function updateTerrainInfo(stageNum) {
            const terrainSelect = document.getElementById(`terrain-${stageNum}`);
            const terrain = terrainSelect.value;
            const terrainInfo = terrainData[terrain];
            
            // Update pace options
            updatePaceOptions(stageNum, terrainInfo.maxPace);
            
            // Update DC display
            const dcDisplay = document.getElementById(`dc-display-${stageNum}`);
            dcDisplay.innerHTML = `
                <strong>Terrain DCs:</strong><br>
                Foraging: ${terrainInfo.foragingDC}<br>
                Navigation: ${terrainInfo.navigationDC}<br>
                Search: ${terrainInfo.searchDC}<br>
                Encounter Distance: ${terrainInfo.encounterDistance}
                ${terrainInfo.note ? `<br><em>${terrainInfo.note}</em>` : ''}
            `;

            // Update travel times
            updateTravelTimes(stageNum);
        }

        function updatePaceOptions(stageNum, maxPace) {
            const paces = ['fast', 'normal', 'slow'];
            const maxPaceIndex = paces.indexOf(maxPace);
            
            paces.forEach((pace, index) => {
                const paceElement = document.getElementById(`${pace}-${stageNum}`);
                if (maxPace === 'special') {
                    paceElement.classList.add('disabled');
                } else if (index <= maxPaceIndex) {
                    paceElement.classList.remove('disabled');
                } else {
                    paceElement.classList.add('disabled');
                }
            });
        }

        function updateTravelTimes(stageNum) {
            const distance = parseFloat(document.getElementById(`distance-${stageNum}`).value) || 0;
            const terrain = document.getElementById(`terrain-${stageNum}`).value;
            
            if (terrainData[terrain].maxPace !== 'special') {
                Object.entries(paceSpeeds).forEach(([pace, speed]) => {
                    const timeElement = document.querySelector(`#${pace}-${stageNum} .time`);
                    const days = distance / speed;
                    const fullDays = Math.floor(days);
                    const hours = Math.round((days - fullDays) * 8);
                    timeElement.textContent = hours > 0 ? 
                        `${fullDays} days, ${hours} hrs` : 
                        `${fullDays} days`;
                });
            }
        }

        function addChallenge(stageNum) {
            const select = document.getElementById(`challenge-type-${stageNum}`);
            const challengeType = select.value;
            if (!challengeType) return;

            const challengesList = document.getElementById(`challenges-list-${stageNum}`);
            const challengeDiv = document.createElement('div');
            challengeDiv.className = 'challenge-item';
            
            let challengeContent = `
                <div class="challenge-header">
                    ${challengeType.charAt(0).toUpperCase() + challengeType.slice(1)}
                    <button onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
                <textarea placeholder="Add notes about this challenge..."></textarea>
            `;
            
            challengeDiv.innerHTML = challengeContent;
            challengesList.appendChild(challengeDiv);
            select.value = ''; // Reset select
        }

        function toggleReference() {
            const content = document.getElementById('reference-content');
            content.classList.toggle('show');
            
            if (content.classList.contains('show')) {
                content.innerHTML = `
                    <h4>Extended Travel Rules</h4>
                    <ul>
                        <li>Characters can push beyond 8 hours of travel per day</li>
                        <li>Each additional hour requires a DC 10 + 1 per extra hour Constitution save</li>
                        <li>Failing the save results in one level of exhaustion</li>
                    </ul>

                    <h4>Special Movement</h4>
                    <ul>
                        <li>Miles per hour = Speed ÷ 10</li>
                        <li>Miles per day (Normal pace) = Miles per hour × hours traveled (typically 8)</li>
                        <li>Fast pace = Miles per day × 1⅓</li>
                        <li>Slow pace = Miles per day × ⅔</li>
                    </ul>

                    <h4>Weather Effects</h4>
                    <ul>
                        <li>Temperature affects survival checks and exhaustion</li>
                        <li>Strong winds can impact ranged attacks and flight</li>
                        <li>Heavy precipitation can obscure vision and affect tracking</li>
                    </ul>
                `;
            }
        }
    </script>
</body>
</html>
